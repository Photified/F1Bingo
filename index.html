<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 2026: CHAMPIONSHIP BINGO</title>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,400;0,600;0,700;0,900;1,400&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --brand-red: #e10600;
            --brand-dark: #15151e;
            --bg-body: #f4f4f8;
            --card-shadow: 0 4px 12px rgba(0,0,0,0.08);
            
            /* Category Colors */
            --c-driver: #ff9500; --c-team: #00d2be;   
            --c-tech: #2962ff;   --c-chaos: #d50000;  
        }

        body {
            font-family: 'Titillium Web', sans-serif;
            background: var(--bg-body);
            color: var(--brand-dark);
            margin: 0; height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- LOGIN OVERLAY --- */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--brand-dark);
            z-index: 1000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: white;
        }
        .login-box {
            background: #222; padding: 40px; border-radius: 10px;
            text-align: center; border: 2px solid var(--brand-red);
            box-shadow: 0 0 50px rgba(225, 6, 0, 0.3);
        }
        .login-input {
            padding: 12px; border-radius: 5px; border: 1px solid #444;
            background: #111; color: white; font-size: 16px; margin-top: 20px;
            width: 250px; text-align: center;
        }
        .login-btn {
            margin-top: 15px; padding: 12px 30px;
            background: var(--brand-red); color: white; border: none;
            font-weight: 900; font-size: 16px; cursor: pointer;
            text-transform: uppercase; border-radius: 5px; width: 100%;
        }

        /* --- HEADER & RACE BAR --- */
        header {
            background: white; border-bottom: 3px solid var(--brand-red);
            padding: 10px 20px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .user-profile { font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .status-dot { width: 10px; height: 10px; background: #ccc; border-radius: 50%; }
        .status-dot.online { background: #00d2be; box-shadow: 0 0 10px #00d2be; }

        .race-bar {
            background: #fff; padding: 10px 0; display: flex;
            overflow-x: auto; border-bottom: 1px solid #ddd;
            scrollbar-width: thin;
        }
        .race-card {
            flex: 0 0 90px; padding: 8px; text-align: center;
            border-right: 1px solid #eee; cursor: pointer;
            opacity: 0.5; transition: 0.2s; position: relative;
        }
        .race-card:hover { opacity: 0.8; background: #fafafa; }
        .race-card.active { opacity: 1; background: #fff0f0; border-bottom: 3px solid var(--brand-red); }
        .race-flag { font-size: 24px; display: block; margin-bottom: 4px; }
        .race-name { font-size: 10px; font-weight: 800; text-transform: uppercase; display: block; }
        .race-date { font-size: 9px; color: #888; display: block; }

        /* --- MAIN LAYOUT --- */
        .main-stage {
            flex: 1; display: flex; padding: 20px; gap: 20px; overflow: hidden;
        }

        /* --- SIDEBAR --- */
        .sidebar { width: 340px; display: flex; flex-direction: column; gap: 15px; }
        
        .panel {
            background: white; border-radius: 8px; box-shadow: var(--card-shadow);
            overflow: hidden; display: flex; flex-direction: column;
        }
        .panel-header {
            padding: 10px; background: #f8f8f8; font-weight: 800;
            font-size: 12px; text-transform: uppercase; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between;
        }

        /* Leaderboard */
        .leaderboard { flex: 1; overflow-y: auto; font-size: 13px; }
        .lb-row {
            display: flex; justify-content: space-between; padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        .lb-row.me { background: #fff8e1; border-left: 3px solid #ffb800; }

        /* Pool */
        .pool-tabs { display: flex; border-bottom: 1px solid #eee; }
        .tab { 
            flex: 1; text-align: center; padding: 10px; font-size: 11px; 
            font-weight: 700; cursor: pointer; color: #888;
        }
        .tab.active { color: #000; border-bottom: 2px solid var(--brand-red); }

        .pool-list { flex: 1; overflow-y: auto; padding: 10px; height: 300px; }
        .chip {
            padding: 8px 10px; margin-bottom: 5px; background: white;
            border: 1px solid #eee; border-left: 4px solid #555;
            border-radius: 4px; font-size: 11px; font-weight: 600; cursor: grab;
        }
        .chip:hover { transform: translateX(2px); }
        .chip.driver { border-left-color: var(--c-driver); }
        .chip.team { border-left-color: var(--c-team); }
        .chip.tech { border-left-color: var(--c-tech); }
        .chip.chaos { border-left-color: var(--c-chaos); }

        /* --- GRID --- */
        .grid-area {
            flex: 1; background: white; border-radius: 8px;
            box-shadow: var(--card-shadow); padding: 20px;
            display: flex; flex-direction: column;
        }
        
        .strategy-bar {
            display: flex; gap: 10px; margin-bottom: 15px; justify-content: center;
        }
        .strat-btn {
            padding: 5px 15px; border: 1px solid #eee; border-radius: 20px;
            font-size: 11px; font-weight: 700; cursor: pointer; background: white;
        }
        .strat-btn:hover { border-color: #ccc; }
        .strat-btn.active { background: var(--brand-dark); color: white; border-color: var(--brand-dark); }

        .bingo-grid {
            display: grid; grid-template-columns: repeat(5, 1fr);
            gap: 8px; width: 100%; max-width: 650px; aspect-ratio: 1/1;
            margin: 0 auto;
        }
        .slot {
            background: #f8f8f8; border: 2px dashed #eee; border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            text-align: center; padding: 5px; font-size: 11px; font-weight: 700;
            position: relative;
        }
        .slot[data-req="driver"] { background: #fffbf0; border-color: #ffe0b2; color: var(--c-driver); }
        .slot[data-req="team"] { background: #f0fffc; border-color: #b2dfdb; color: var(--c-team); }
        .slot[data-req="tech"] { background: #f0f7ff; border-color: #bbdefb; color: var(--c-tech); }
        .slot[data-req="chaos"] { background: #fff5f5; border-color: #ffcdd2; color: var(--c-chaos); }

        .slot.filled { border: none; color: white !important; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .slot.filled[data-type="driver"] { background: var(--c-driver); }
        .slot.filled[data-type="team"] { background: var(--c-team); }
        .slot.filled[data-type="tech"] { background: var(--c-tech); }
        .slot.filled[data-type="chaos"] { background: var(--c-chaos); }
        
        .slot.center { background: #222 !important; color: var(--brand-red) !important; border:none; }

        .slot:hover::after {
            content: '√ó'; position: absolute; top:0; right:5px; font-size:16px; opacity:0.5;
        }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h1 style="margin:0; font-style:italic;">F1 <span style="color:var(--brand-red)">2026</span> BINGO</h1>
        <p style="color:#888; font-size:12px;">OFFICIAL TEAM PRINCIPAL LOGIN</p>
        
        <input type="text" id="teamNameInput" class="login-input" placeholder="Enter Team Name...">
        <button class="login-btn" onclick="login()">Enter Paddock</button>
        <p style="font-size:10px; color:#555; margin-top:10px;">Connecting to FIA Servers...</p>
    </div>
</div>

<header>
    <div class="user-profile">
        <div class="status-dot" id="connectionDot"></div>
        <span id="displayTeamName">GUEST TEAM</span>
    </div>
    <div style="font-weight:900; font-style:italic; font-size:20px;">F1 <span style="color:var(--brand-red)">2026</span></div>
    <button onclick="saveToServer()" style="background:var(--brand-red); color:white; border:none; padding:8px 15px; border-radius:4px; font-weight:bold; cursor:pointer;">CLOUD SAVE</button>
</header>

<div class="race-bar" id="raceBar">
    </div>

<div class="main-stage">
    
    <div class="sidebar">
        <div class="panel" style="height:250px;">
            <div class="panel-header">
                <span>üèÜ Championship</span>
                <span id="totalPoints">0 pts</span>
            </div>
            <div class="leaderboard" id="leaderboardList">
                <div class="lb-row"><span>Loading Standings...</span></div>
            </div>
        </div>

        <div class="panel" style="flex:1;">
            <div class="panel-header">Components Pool</div>
            <div class="pool-tabs">
                <div class="tab active" onclick="setPool('driver')" id="tab-driver">Drivers</div>
                <div class="tab" onclick="setPool('team')" id="tab-team">Teams</div>
                <div class="tab" onclick="setPool('tech')" id="tab-tech">Tech</div>
                <div class="tab" onclick="setPool('chaos')" id="tab-chaos">Chaos</div>
            </div>
            <div id="pool" class="pool-list"></div>
        </div>
    </div>

    <div class="grid-area">
        <div class="strategy-bar">
            <button class="strat-btn active" onclick="applyTemplate('balanced')">‚öñÔ∏è Balanced</button>
            <button class="strat-btn" onclick="applyTemplate('tech')">üîß Tech Spec</button>
            <button class="strat-btn" onclick="applyTemplate('chaos')">üö© Chaos</button>
            <button class="strat-btn" onclick="applyTemplate('driver')">üèéÔ∏è Driver Market</button>
        </div>

        <div id="grid" class="bingo-grid"></div>
        
        <div style="text-align:center; margin-top:10px; font-size:10px; color:#999;">
            * Changes are auto-saved locally. Click CLOUD SAVE to update leaderboard.
        </div>
    </div>
</div>

<script>
    // --- FIREBASE CONFIGURATION (REPLACE WITH YOUR KEYS) ---
    // 1. Go to console.firebase.google.com -> Create Project
    // 2. Add Web App -> Copy config here
    // 3. Enable Firestore Database & Auth (Anonymous)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY_HERE",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "SENDER_ID",
        appId: "APP_ID"
    };

    // Initialize Firebase (Safely)
    let db, auth;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        auth = firebase.auth();
    } catch(e) {
        console.warn("Firebase not configured. Running in Offline Mode.");
    }

    // --- DATA ---
    const races2026 = [
        {id:'aus', f:'üá¶üá∫', n:'Australia', d:'Mar 6-8'},
        {id:'chn', f:'üá®üá≥', n:'China', d:'Mar 13-15'},
        {id:'jpn', f:'üáØüáµ', n:'Japan', d:'Mar 27-29'},
        {id:'bhr', f:'üáßüá≠', n:'Bahrain', d:'Apr 10-12'},
        {id:'sau', f:'üá∏üá¶', n:'Saudi', d:'Apr 17-19'},
        {id:'mia', f:'üá∫üá∏', n:'Miami', d:'May 1-3'},
        {id:'can', f:'üá®üá¶', n:'Canada', d:'May 22-24'}, // New date
        {id:'mon', f:'üá≤üá®', n:'Monaco', d:'Jun 5-7'},
        {id:'bar', f:'üá™üá∏', n:'Barcelona', d:'Jun 12-14'},
        {id:'aut', f:'üá¶üáπ', n:'Austria', d:'Jun 26-28'},
        {id:'gbr', f:'üá¨üáß', n:'Silverstone', d:'Jul 3-5'},
        {id:'bel', f:'üáßüá™', n:'Spa', d:'Jul 17-19'},
        {id:'hun', f:'üá≠üá∫', n:'Hungary', d:'Jul 24-26'},
        {id:'ned', f:'üá≥üá±', n:'Zandvoort', d:'Aug 21-23'},
        {id:'ita', f:'üáÆüáπ', n:'Monza', d:'Sep 4-6'},
        {id:'mad', f:'üá™üá∏', n:'Madrid', d:'Sep 11-13'}, // Debut
        {id:'aze', f:'üá¶üáø', n:'Baku', d:'Sep 25-27'},
        {id:'sin', f:'üá∏üá¨', n:'Singapore', d:'Oct 9-11'},
        {id:'usa', f:'üá∫üá∏', n:'Austin', d:'Oct 23-25'},
        {id:'mex', f:'üá≤üáΩ', n:'Mexico', d:'Oct 30-Nov 1'},
        {id:'bra', f:'üáßüá∑', n:'Brazil', d:'Nov 6-8'},
        {id:'lvg', f:'üá∫üá∏', n:'Las Vegas', d:'Nov 19-21'},
        {id:'qat', f:'üá∂üá¶', n:'Qatar', d:'Nov 27-29'},
        {id:'abu', f:'üá¶üá™', n:'Abu Dhabi', d:'Dec 4-6'}
    ];

    const templates = {
        balanced: ['driver','driver','team','tech','chaos','driver','team','tech','chaos','driver','team','tech','FREE','driver','team','tech','chaos','driver','team','tech','chaos','driver','team','tech','chaos'],
        tech: ['tech','tech','team','driver','tech','tech','team','driver','tech','chaos','team','driver','FREE','tech','tech','driver','tech','chaos','tech','team','tech','team','tech','driver','chaos'],
        chaos: ['chaos','chaos','driver','team','chaos','chaos','driver','team','chaos','tech','driver','team','FREE','chaos','chaos','team','chaos','tech','chaos','driver','chaos','driver','chaos','team','chaos'],
        driver: ['driver','driver','driver','team','driver','driver','team','chaos','driver','driver','team','driver','FREE','driver','team','driver','chaos','team','driver','driver','driver','driver','team','driver','chaos']
    };

    // App State
    let currentUser = null;
    let poolData = {};
    let activeRace = 'aus';
    let currentGrid = Array(25).fill(null);
    let currentPoolCat = 'driver';

    // --- INITIALIZATION ---
    async function init() {
        // Load Pool Data
        try {
            const res = await fetch('data.json');
            poolData = await res.json();
        } catch(e) { console.log('Err loading JSON'); }

        renderRaces();
        applyTemplate('balanced'); // Default grid
        renderPool();
        
        // If user already logged in (localStorage), skip login screen
        const savedTeam = localStorage.getItem('f1_team_name');
        if(savedTeam) {
            document.getElementById('teamNameInput').value = savedTeam;
            login();
        }
    }

    // --- AUTH & SERVER ---
    function login() {
        const teamName = document.getElementById('teamNameInput').value;
        if(!teamName) return alert("Enter Team Name");

        currentUser = { name: teamName, id: teamName.replace(/\s+/g, '_').toLowerCase() };
        localStorage.setItem('f1_team_name', teamName);
        
        // UI Updates
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('displayTeamName').innerText = teamName.toUpperCase();
        document.getElementById('connectionDot').classList.add('online');

        // Firebase Login
        if(auth) {
            auth.signInAnonymously().catch(console.error);
            loadCloudData(); // Fetch existing grid if any
            listenToLeaderboard();
        } else {
            // Mock Leaderboard for Offline Mode
            renderLeaderboard([
                {name: teamName, score: 0},
                {name: "Christian Horner", score: 150},
                {name: "Toto Wolff", score: 120}
            ]);
        }
    }

    function saveToServer() {
        if(!db || !currentUser) return alert("Server not configured. Saved locally.");
        
        db.collection('players').doc(currentUser.id).set({
            name: currentUser.name,
            score: 0, // In real app, this would be calculated by server
            [`grid_${activeRace}`]: currentGrid,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true })
        .then(() => alert("Grid Synced to Cloud!"))
        .catch(e => alert("Sync Error: " + e.message));
    }

    function loadCloudData() {
        if(!db) return;
        db.collection('players').doc(currentUser.id).get().then(doc => {
            if(doc.exists) {
                const data = doc.data();
                const savedGrid = data[`grid_${activeRace}`];
                if(savedGrid) {
                    currentGrid = savedGrid;
                    renderGrid();
                }
            }
        });
    }

    function listenToLeaderboard() {
        if(!db) return;
        db.collection('players').orderBy('score', 'desc').limit(10)
          .onSnapshot(snapshot => {
              const players = [];
              snapshot.forEach(doc => players.push(doc.data()));
              renderLeaderboard(players);
          });
    }

    function renderLeaderboard(players) {
        const list = document.getElementById('leaderboardList');
        list.innerHTML = '';
        players.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `lb-row ${p.name === currentUser.name ? 'me' : ''}`;
            div.innerHTML = `<span>#${i+1} ${p.name}</span> <strong>${p.score || 0}</strong>`;
            list.appendChild(div);
        });
    }

    // --- UI RENDERING ---
    function renderRaces() {
        const bar = document.getElementById('raceBar');
        races2026.forEach(r => {
            const el = document.createElement('div');
            el.className = `race-card ${r.id === activeRace ? 'active' : ''}`;
            el.onclick = () => { activeRace = r.id; renderRaces(); loadCloudData(); };
            el.innerHTML = `
                <span class="race-flag">${r.f}</span>
                <span class="race-name">${r.n}</span>
                <span class="race-date">${r.d}</span>
            `;
            bar.appendChild(el);
        });
    }

    function setPool(cat) {
        currentPoolCat = cat;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${cat}`).classList.add('active');
        renderPool();
    }

    function renderPool() {
        const container = document.getElementById('pool');
        container.innerHTML = '';
        if(!poolData[currentPoolCat]) return;

        poolData[currentPoolCat].forEach(text => {
            const div = document.createElement('div');
            div.className = `chip ${currentPoolCat}`;
            div.innerText = text;
            div.draggable = true;
            div.ondragstart = e => {
                e.dataTransfer.setData('text', text);
                e.dataTransfer.setData('type', currentPoolCat);
            };
            container.appendChild(div);
        });
    }

    function applyTemplate(type) {
        const pattern = templates[type];
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        
        // Update Grid UI Structure
        pattern.forEach((reqType, i) => {
            const slot = document.createElement('div');
            
            if(reqType === 'FREE') {
                slot.className = 'slot center';
                slot.innerText = "LIGHTS OUT";
                currentGrid[i] = { text: "LIGHTS OUT", type: "FREE" };
            } else {
                slot.className = 'slot';
                slot.dataset.index = i;
                slot.dataset.req = reqType;
                
                slot.ondragover = e => e.preventDefault();
                slot.ondrop = e => handleDrop(e, i, reqType);
                slot.onclick = () => clearSlot(i);

                // Restore if data exists
                if(currentGrid[i]) {
                    slot.innerText = currentGrid[i].text;
                    slot.className = `slot filled`;
                    slot.dataset.type = currentGrid[i].type;
                }
            }
            grid.appendChild(slot);
        });
    }

    function handleDrop(e, index, reqType) {
        e.preventDefault();
        const text = e.dataTransfer.getData('text');
        const type = e.dataTransfer.getData('type');

        if(type !== reqType) return alert(`Wrong Type! This slot needs a ${reqType.toUpperCase()}`);

        currentGrid[index] = { text, type };
        renderGrid(); // Re-render to show filled state
    }

    function renderGrid() {
        // Refresh grid UI based on currentGrid state
        const slots = document.querySelectorAll('.slot:not(.center)');
        slots.forEach(slot => {
            const idx = slot.dataset.index;
            const data = currentGrid[idx];
            if(data) {
                slot.innerText = data.text;
                slot.dataset.type = data.type;
                slot.classList.add('filled');
            } else {
                slot.innerText = '';
                slot.classList.remove('filled');
                delete slot.dataset.type;
            }
        });
    }

    function clearSlot(index) {
        currentGrid[index] = null;
        renderGrid();
    }

    window.onload = init;
</script>

</body>
</html>